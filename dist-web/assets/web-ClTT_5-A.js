var y=Object.defineProperty;var p=(e,t,s)=>t in e?y(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var l=(e,t,s)=>p(e,typeof t!="symbol"?t+"":t,s);const u=()=>typeof window<"u"?window.location.origin:"http://localhost:3000";async function a(e,t){const s=await fetch(`${u()}/api/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:t?JSON.stringify(t):void 0});if(!s.ok){const n=await s.json().catch(()=>({error:s.statusText}));throw new Error(n.error||"API request failed")}return s.json()}class m{constructor(t,s,n){l(this,"ws");l(this,"_pid",-1);l(this,"dataCallbacks",[]);l(this,"exitCallbacks",[]);const c=u().replace("http","ws"),d=new URLSearchParams({shell:t,cols:String(n?.cols||80),rows:String(n?.rows||24),cwd:n?.cwd||""});this.ws=new WebSocket(`${c}/ws/pty?${d}`),this.ws.onmessage=o=>{try{const i=JSON.parse(o.data);switch(i.type){case"session":this._pid=i.pid;break;case"data":this.dataCallbacks.forEach(r=>r(i.data));break;case"exit":this.exitCallbacks.forEach(r=>r({exitCode:i.exitCode}));break}}catch(i){console.error("[WebSocketPty] Message parse error:",i)}},this.ws.onerror=o=>{console.error("[WebSocketPty] WebSocket error:",o)},this.ws.onclose=()=>{this.exitCallbacks.forEach(o=>o({exitCode:0}))}}get pid(){return this._pid}onData(t){this.dataCallbacks.push(t)}onExit(t){this.exitCallbacks.push(t)}write(t){this.ws.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify({type:"data",data:t}))}resize(t,s){this.ws.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify({type:"resize",cols:t,rows:s}))}kill(){this.ws.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify({type:"kill"})),this.ws.close()}}function f(e,t,s){const n=[],c=[],d=[],o=[];return{stdout:{on:(i,r)=>{n.push(r)}},stderr:{on:(i,r)=>{c.push(r)}},on:(i,r)=>{i==="close"&&d.push(r),i==="error"&&o.push(r)},spawn:async()=>{const i=t?`${e} ${t.join(" ")}`:e;try{const r=await a("shell/exec",{command:i,cwd:s?.cwd});return r.stdout&&n.forEach(w=>w(r.stdout)),r.stderr&&c.forEach(w=>w(r.stderr)),d.forEach(w=>w({code:r.exitCode})),{pid:-1,write:async()=>{},kill:async()=>{}}}catch(r){const w=r instanceof Error?r.message:"Unknown error";throw o.forEach(h=>h(w)),r}}}}const k={type:"web",fs:{readTextFile:async(e,t)=>(await a("fs/read",{path:e})).content,writeTextFile:async(e,t,s)=>{await a("fs/write",{path:e,content:t})},readDir:async e=>(await a("fs/readdir",{path:e})).entries,stat:async e=>a("fs/stat",{path:e}),exists:async(e,t)=>(await a("fs/exists",{path:e})).exists,mkdir:async(e,t)=>{await a("fs/mkdir",{path:e,recursive:t?.recursive??!0})},remove:async(e,t)=>{await a("fs/remove",{path:e,recursive:t?.recursive??!1})},rename:async(e,t)=>{await a("fs/rename",{oldPath:e,newPath:t})},copy:async(e,t,s)=>{await a("fs/copy",{src:e,dest:t,recursive:s?.recursive??!1})}},path:{join:async(...e)=>(await a("path/join",{paths:e})).path,homeDir:async()=>(await a("path/home",{})).path,appDataDir:async()=>(await a("path/appdata",{})).path,dirname:e=>{const t=e.split("/");return t.pop(),t.join("/")||"/"},basename:e=>{const t=e.split("/");return t[t.length-1]||""}},shell:{createCommand:f},pty:{spawn:(e,t,s)=>new m(e,t,s)},http:{fetch:async(e,t)=>{const s=await fetch(e,{method:t?.method||"GET",headers:t?.headers,body:t?.body,signal:t?.timeout?AbortSignal.timeout(t.timeout):void 0}),n=await s.text(),c={};return s.headers.forEach((d,o)=>{c[o]=d}),{status:s.status,statusText:s.statusText,headers:c,body:n,ok:s.ok}}},window:{createNew:async()=>window.open(window.location.href,"_blank")?"new-tab":"",close:async()=>{window.close()},minimize:async()=>{},maximize:async()=>{},setVibrancy:async e=>{},setOpacity:async e=>{},getCount:async()=>1},webview:{create:async(e,t,s)=>{throw new Error("Webviews not implemented in web mode")},updateBounds:async(e,t)=>{throw new Error("Webviews not implemented in web mode")},navigate:async(e,t)=>{throw new Error("Webviews not implemented in web mode")},destroy:async e=>{throw new Error("Webviews not implemented in web mode")},executeScript:async(e,t)=>{throw new Error("Webviews not implemented in web mode")},hideAll:async()=>{},showAll:async()=>{}},git:{status:async e=>a("git/status",{repoPath:e}),stageFile:async(e,t)=>{await a("git/stage",{repoPath:e,file:t})},unstageFile:async(e,t)=>{await a("git/unstage",{repoPath:e,file:t})},commit:async(e,t)=>{await a("git/commit",{repoPath:e,message:t})},push:async e=>{await a("git/push",{repoPath:e})},checkoutBranch:async(e,t)=>{await a("git/checkout",{repoPath:e,branch:t})}},system:{openUrl:async e=>{window.open(e,"_blank","noopener,noreferrer")},getCurrentDirectory:async()=>(await a("system/cwd",{})).cwd},events:{listen:async(e,t)=>{const s=n=>t(n.detail);return window.addEventListener(e,s),()=>window.removeEventListener(e,s)},emit:async(e,t)=>{window.dispatchEvent(new CustomEvent(e,{detail:t}))}},menu:{showSplitContextMenu:async(e,t,s,n)=>""}};export{k as webPlatform};
