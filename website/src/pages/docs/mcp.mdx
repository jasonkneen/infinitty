---
layout: ../../layouts/DocLayout.astro
title: MCP Integration
description: Model Context Protocol integration with Claude and other AI models
---

## What is MCP?

Model Context Protocol is a standardized way for AI models to:

- **Discover** what tools are available
- **Call** tools with structured inputs
- **Receive** results in a standard format
- **Stream** long-running operations

It's like an API for AI models.

## Infinitty MCP Support

Infinitty implements MCP servers for:

1. **Built-in tools** - Terminal, file system, workflows
2. **Widgets** - Each widget exposes tools via MCP
3. **External servers** - Connect to your own MCP implementations

## Using MCP with Claude

### Basic Tool Call

Ask Claude to use a tool:

```
ai "List all my saved workflows"
# Claude calls: com.flows.workflow:list_workflows
```

Claude automatically:
1. Discovers available tools
2. Determines which one to use
3. Calls the tool with proper inputs
4. Interprets the result
5. Responds with the answer

### Tools Available

Check what tools are available:

```bash
# Via CLI
infinitty --list-tools

# Via API
curl http://localhost:3030/tools/list
```

## Built-in Tools

### Workflow Tools

| Tool | Description |
|------|-------------|
| `list_workflows` | List saved workflows |
| `run_workflow` | Execute a workflow |
| `save_workflow` | Save workflow to disk |
| `load_workflow` | Load workflow from disk |
| `delete_workflow` | Delete workflow |

### Terminal Tools

| Tool | Description |
|------|-------------|
| `execute_command` | Run shell command |
| `list_files` | List directory contents |
| `read_file` | Read file contents |
| `write_file` | Write to file |
| `get_cwd` | Get current directory |

### File Tools

| Tool | Description |
|------|-------------|
| `find_files` | Search for files |
| `copy_file` | Copy file |
| `move_file` | Move/rename file |
| `delete_file` | Delete file |

## Creating MCP Servers

### Minimal Server

```typescript
import { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js'
import { StdioServerTransport } from '@modelcontextprotocol/sdk/server/stdio.js'

const server = new McpServer({
  name: 'my-server',
  version: '1.0.0',
})

// Register a tool
server.registerTool(
  'add_numbers',
  {
    description: 'Add two numbers',
    inputSchema: {
      type: 'object',
      properties: {
        a: { type: 'number' },
        b: { type: 'number' },
      },
    },
  },
  async (input) => ({
    content: [
      {
        type: 'text',
        text: `${input.a} + ${input.b} = ${input.a + input.b}`,
      },
    ],
  })
)

// Connect and run
const transport = new StdioServerTransport()
await server.connect(transport)
```

### HTTP/WebSocket Server

```typescript
import express from 'express'
import { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js'
import { StreamableHTTPServerTransport } from '@modelcontextprotocol/sdk/server/streamableHttp.js'

const app = express()
const server = new McpServer({
  name: 'my-api-server',
  version: '1.0.0',
})

app.post('/mcp', async (req, res) => {
  const transport = new StreamableHTTPServerTransport()
  await server.connect(transport)
  await transport.handleRequest(req, res, req.body)
})

app.listen(3000)
```

## Tool Definition Schema

```typescript
server.registerTool(
  'tool_name',
  {
    title: 'Human Readable Name',
    description: 'What this tool does',
    inputSchema: {
      type: 'object',
      properties: {
        param1: {
          type: 'string',
          description: 'First parameter',
        },
        param2: {
          type: 'number',
          description: 'Second parameter',
        },
      },
      required: ['param1'],
    },
  },
  async (input) => {
    // Implementation
    const result = await doSomething(input.param1, input.param2)
    return {
      content: [
        {
          type: 'text',
          text: JSON.stringify(result),
        },
      ],
    }
  }
)
```

## Connecting Custom MCP Servers

### Configuration

Add to `~/.infinitty/config.json`:

```json
{
  "mcpServers": [
    {
      "name": "my-server",
      "command": "node",
      "args": ["/path/to/server.js"],
      "env": {
        "LOG_LEVEL": "debug"
      }
    }
  ]
}
```

### Via Claude Desktop Config

Create `~/.claude/claude_desktop_config.json`:

```json
{
  "mcpServers": {
    "my-server": {
      "command": "node",
      "args": ["/path/to/server.js"]
    }
  }
}
```

Then Infinitty can access those servers too.

## Example: Weather Tool

```typescript
import { z } from 'zod'

server.registerTool(
  'get_weather',
  {
    description: 'Get current weather for a city',
    inputSchema: z.object({
      city: z.string().describe('City name'),
      units: z.enum(['celsius', 'fahrenheit']).default('celsius'),
    }),
  },
  async (input) => {
    const { city, units } = input as { city: string; units: string }

    try {
      const response = await fetch(
        `https://api.weatherapi.com/v1/current.json?q=${city}&aqi=no`
      )
      const data = await response.json()

      const temp =
        units === 'fahrenheit'
          ? (data.current.temp_c * 9) / 5 + 32
          : data.current.temp_c

      return {
        content: [
          {
            type: 'text',
            text: `Weather in ${city}: ${temp}°${units === 'fahrenheit' ? 'F' : 'C'}, ${data.current.condition.text}`,
          },
        ],
      }
    } catch (error) {
      return {
        content: [
          {
            type: 'text',
            text: `Error: Could not fetch weather for ${city}`,
          },
        ],
      }
    }
  }
)
```

Usage:

```
ai "What's the weather in San Francisco?"
# Claude calls: get_weather with city="San Francisco"
# Response: "Weather in San Francisco: 18°C, Partly cloudy"
```

## Streaming Results

For long operations, stream results:

```typescript
server.registerTool(
  'process_file',
  {
    description: 'Process a large file',
    inputSchema: z.object({
      filename: z.string(),
    }),
  },
  async (input) => {
    const lines: string[] = []

    // Stream processing
    for (const line of processFile(input.filename)) {
      lines.push(line)
      // In real implementation, stream results
    }

    return {
      content: [
        {
          type: 'text',
          text: lines.join('\n'),
        },
      ],
    }
  }
)
```

## Error Handling

```typescript
server.registerTool(
  'risky_operation',
  {...},
  async (input) => {
    try {
      const result = await doRiskyThing()
      return {
        content: [{ type: 'text', text: JSON.stringify(result) }],
      }
    } catch (error) {
      return {
        content: [
          {
            type: 'text',
            text: `Error: ${error.message}`,
            isError: true,
          },
        ],
      }
    }
  }
)
```

## Testing MCP Tools

### Via cURL

```bash
# Get tool list
curl -X POST http://localhost:3030/mcp \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "id": 1,
    "method": "tools/list",
    "params": {}
  }'

# Call a tool
curl -X POST http://localhost:3030/mcp \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "id": 2,
    "method": "tools/call",
    "params": {
      "name": "get_weather",
      "arguments": {
        "city": "New York"
      }
    }
  }'
```

### Via JavaScript

```typescript
const response = await fetch('http://localhost:3030/mcp', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    jsonrpc: '2.0',
    id: 1,
    method: 'tools/call',
    params: {
      name: 'get_weather',
      arguments: { city: 'London' },
    },
  }),
})

const result = await response.json()
console.log(result)
```

## Best Practices

1. **Clear descriptions** - Help Claude understand what the tool does
2. **Proper schemas** - Use Zod for validation
3. **Error handling** - Return helpful error messages
4. **Resource limits** - Timeout long operations
5. **Logging** - Log tool calls for debugging
6. **Security** - Validate all inputs before use
7. **Documentation** - Comment your tool code

## MCP Resources

- [MCP Specification](https://modelcontextprotocol.io)
- [SDK Documentation](https://github.com/anthropics/anthropic-sdk-python/tree/main/docs/mcp)
- [Examples](https://github.com/modelcontextprotocol/servers)

## Next Steps

- [Widget Development](/docs/widgets)
- [Workflow Examples](/docs/workflows)
- [API Reference](/docs/api)
